# VPS для самых маленьких

> Подробная документация по VPS и защите SSH соединения

---

## Содержание

- [Что такое VPS/VDS сервер](#что-такое-vpsvds-сервер)
  - [Параметры при аренде VPS](#параметры-при-аренде-vps)
- [Требования к VPS-провайдеру и серверу](#требования-к-vps-провайдеру-и-серверу)
  - [Требования к провайдеру](#требования-к-провайдеру)
  - [Требования к техническим характеристикам сервера](#требования-к-техническим-характеристикам-сервера)
- [Выбор оптимальной локации VPS-сервера для проксирования трафика](#выбор-оптимальной-локации-vps-сервера-для-проксирования-трафика)
  - [Почему важно выбирать правильную локацию VPS](#почему-важно-выбирать-правильную-локацию-vps)
  - [Критерии выбора оптимальной локации VPS](#критерии-выбора-оптимальной-локации-vps)
  - [Разведывательные альянсы: Five Eyes и Fourteen Eyes](#разведывательные-альянсы-five-eyes-и-fourteen-eyes)
  - [Рекомендуемые страны для VPS](#рекомендуемые-страны-для-vps)
  - [Страны, которых следует избегать](#страны-которых-следует-избегать)
  - [Практические рекомендации по выбору локации](#практические-рекомендации-по-выбору-локации)
- [Базовая настройка и обеспечение безопасности сервера](#базовая-настройка-и-обеспечение-безопасности-сервера)
  - [1. Смена пароля суперпользователя (root)](#1-смена-пароля-суперпользователя-root)
  - [2. Обновление системы](#2-обновление-системы)
  - [3. Защита SSH соединения](#3-защита-ssh-соединения)
  - [4. Установка и настройка Fail2ban](#4-установка-и-настройка-fail2ban)
  - [5. Установка необходимых пакетов](#5-установка-необходимых-пакетов)
- [Проверка безопасности сервера](#проверка-безопасности-сервера)
- [Заключение](#заключение)

---

## Что такое VPS/VDS сервер

VPS (Virtual Private Server) / VDS (Virtual Dedicated Server) — это виртуальный выделенный сервер, к которому клиент получает доступ с помощью удалённого соединения (например, SSH). С точки зрения управления операционной системой такой сервер практически не отличается от физического выделенного сервера и обычно предоставляется с IPv4 или IPv6 адресом.

Технически VPS представляет собой виртуальную машину, запущенную на физическом сервере с использованием технологий виртуализации, таких как KVM, Xen, Hyper-V, VMWare и других. На современном рынке VPS и VDS являются синонимами.

### Параметры при аренде VPS

При аренде VPS у облачных провайдеров/хостеров вы можете выбрать:

- Количество ядер процессора
- Объем оперативной памяти (ОЗУ)
- Дисковое пространство
- Дополнительные характеристики (защита от DDoS-атак, резервное копирование, техническая поддержка)
- Объем интернет-трафика на месяц (лучше выбирать безлимитные варианты)

Серверы арендуются на заданный период времени. Провайдеры предоставляют панель управления для мониторинга состояния сервера, его перезагрузки, смены операционной системы и продления аренды.

---

## Требования к VPS-провайдеру и серверу

При выборе VPS-провайдера и конфигурации сервера рекомендуется учитывать следующие критерии:

### Требования к провайдеру

- **Способы оплаты:** наличие поддержки оплаты удобными для вас методами
- **Географическое расположение:** серверы должны находиться в стабильных странах с хорошим международным сетевым подключением
- **Конфиденциальность:** минимальные требования к персональным данным при регистрации
- **Безопасность:** наличие базовой защиты от DoS-атак и резервного копирования
- **Аптайм (Uptime):** должно быть гарантированное время непрерывной работы не менее 98%

### Требования к техническим характеристикам сервера

- **Диск:** SSD NVME накопитель объемом от 10 ГБ
- **Оперативная память:** минимум 1 ГБ, рекомендуется от 2 ГБ
- **Процессор:** 1-2 ядра с частотой от 3 ГГц на современных процессорах
- **Трафик:** безлимитный или не менее 3 ТБ в месяц
- **Сетевое подключение:** пропускная способность канала от 100 Мбит/с
- **Операционная система:** рекомендуется ubuntu 22.04 / 24.04
- **IP-адрес:** статический IP-адрес в стране размещения сервера

---

## Выбор оптимальной локации VPS-сервера для проксирования трафика

Выбор географического расположения VPS-сервера является одним из самых критически важных решений при настройке системы проксирования трафика. От правильного выбора локации зависит не только скорость соединения и доступность сервисов, но и ваша цифровая безопасность, приватность и защита от слежки. Рассмотрим детально все аспекты этого вопроса.

### Почему важно выбирать правильную локацию VPS

### Критерии выбора оптимальной локации VPS

При выборе страны для размещения VPS-сервера следует учитывать следующие факторы:

**1. Географическая близость к точке использования**

Чем ближе физическое расположение сервера к вашему реальному местоположению, тем ниже задержки (ping) и выше скорость соединения.

**2. Наличие подводных кабелей и сетевой инфраструктуры**

Выбирайте страны, которые имеют развитую инфраструктуру подключения к глобальной сети через подводные оптоволоконные кабели. Это обеспечивает стабильное и быстрое соединение с другими континентами. Проверить глобальную карту подводных кабелей можно на сайте [Submarine Cable Map](https://www.submarinecablemap.com/).

**3. Доступность необходимых сервисов**

Важно проверить, нет ли в выбранной стране своих ограничений на нужные вам сервисы.

**4. Политическая и правовая стабильность**

Страна должна иметь:

- Стабильное правительство
- Предсказуемую правовую систему
- Защиту частной информации в законодательстве
- Отсутствие произвольных блокировок интернет-ресурсов

**5. Отношение к цифровым правам и приватности**

Предпочтение следует отдавать странам, где:

- Строго защищены права на приватность
- Нет обязательного хранения данных пользователей
- Нет наказания за использование анонимных сетей и прокси
- Лояльное отношение к цифровому пиратству (если это важно для вас)

**6. Отсутствие членства в разведывательных альянсах**

Это один из самых важных критериев для обеспечения приватности. Необходимо избегать стран, входящих в разведывательные альянсы, особенно Five Eyes и Fourteen Eyes.

### Разведывательные альянсы: Five Eyes и Fourteen Eyes

#### Альянс Five Eyes (Пять глаз)

Five Eyes (FVEY) — это англоязычный разведывательный альянс, созданный после Второй мировой войны. Это самое обширное и мощное соглашение по обмену сигналами разведки (SIGINT) в мире.

**Страны-участницы:**

- США (National Security Agency - NSA)
- Великобритания (Government Communications Headquarters - GCHQ)
- Канада (Communications Security Establishment - CSE)
- Австралия (Australian Signals Directorate - ASD)
- Новая Зеландия (Government Communications Security Bureau - GCSB)

**Особенности Five Eyes:**

- Полный обмен данными: участники не ограничивают друг друга в сборе разведданных на своих граждан
- Глобальный охват: сеть слежки охватывает практически всю планету
- Совместные проекты: такие как PRISM, XKeyscore, Tempora
- Отсутствие судебного контроля: разведслужбы могут получать доступ к данным без ордера при взаимодействии между участниками

**Риски для пользователей VPS в странах Five Eyes:**

- Все данные, проходящие через сервер в этих странах, могут быть перехвачены и переданы другим участникам альянса
- Провайдеры VPS в этих странах могут быть обязаны предоставлять данные по запросу разведслужб
- Даже при отсутствии явных подозрений ваши данные могут быть сохранены и проанализированы
- Высокий риск того, что анонимность будет скомпрометирована

#### Альянс Fourteen Eyes (Четырнадцать глаз)

Fourteen Eyes (14 Eyes) — это расширенная версия Five Eyes, официально известная как SIGINT Seniors Europe (SSEUR). Этот альянс включает страны Five Eyes плюс девять европейских государств.

**Страны-участницы Fourteen Eyes:**

- Все страны Five Eyes (США, Великобритания, Канада, Австралия, Новая Зеландия)
- Дания
- Франция
- Норвегия
- Нидерланды
- Германия
- Бельгия
- Швеция
- Испания
- Италия

**Особенности Fourteen Eyes:**

- Менее интегрированный, чем Five Eyes, но все равно представляет серьезную угрозу приватности
- Официальный обмен информацией между разведслужбами участников
- Совместные операции по сбору сигналов разведки
- Меньше ограничений на слежку за гражданами других стран-участниц

### Рекомендуемые страны для VPS

На основе анализа всех критериев, особенно с учетом отсутствия участия в разведывательных альянсах и обеспечения приватности, рекомендуются следующие страны:

#### Оптимальные варианты (первый приоритет):

- **Ирландия:** Стабильная экономика, хорошие связи с Европой и США, не входит в 14 Eyes, благоприятное законодательство для IT-компаний
- **Румыния:** Низкие цены на VPS, хорошие скорости подключения к России и Европе, независимая от разведывательных альянсов
- **Исландия:** Сильные законы о защите данных, полная независимость от разведывательных альянсов, экологичная инфраструктура
- **Швейцария:** Самые строгие законы о банковской и цифровой тайне в мире, политический нейтралитет, не входит в 14 Eyes
- **Страны Индии:** Временный вариант с хорошими скоростями до Азии и России, но с осторожностью из-за политической нестабильности

#### Приемлемые варианты (второй приоритет, с оговорками):

- **Нидерланды:** Хотя входят в 14 Eyes, имеют одну из лучших сетевых инфраструктур в Европе и относительно прогрессивное законодательство о приватности
- **Швеция:** Хорошие скорости, но входит в 14 Eyes, что представляет определенный риск
- **Германия:** Сильные законы о защите данных, но является членом 14 Eyes
- **Сингапур:** Отличное подключение к Азии, но с ограничениями на некоторые западные сервисы
- **Тайвань:** Хорошие скорости к Азии и относительно независим от основных разведывательных альянсов
- **Япония:** Стабильная инфраструктура, но с некоторыми ограничениями на контент

### Страны, которых следует избегать

#### Категорически не рекомендуется:

- **Все страны Five Eyes (США, Великобритания, Канада, Австралия, Новая Зеландия)** — максимальный риск компрометации данных

#### С осторожностью (третий приоритет):

- **Китай** — жесткая цензура, блокировка большинства западных сервисов, требование о хранении данных
- **Иран** — политическая нестабильность, жесткая цензура, риск конфискации данных
- **Турция** — нестабильное законодательство, частые блокировки сервисов
- **Страны Африки** — часто ненадежная инфраструктура, политическая нестабильность, слабая защита данных

### Практические рекомендации по выбору локации

1. **Проверьте реальную скорость перед арендой:**
   - Используйте сервисы вроде LookingGlass для проверки ping и скорости
   - Протестируйте доступ к ключевым сервисам из предполагаемой локации

2. **Проверьте принадлежность IP-адреса:**
   - Используйте сервисы [IPinfo.io](https://ipinfo.io/) и [bgp.he.net](https://bgp.he.net/) для проверки реальной геолокации сервера
   - Убедитесь, что IP-адрес не находится в черных списках Роскомнадзора или спам-базах

3. **Изучите законодательство страны размещения:**
   - Проверьте законы о хранении данных и обязанности провайдеров
   - Узнайте о сроках хранения логов и порядке их предоставления властям

4. **Выбирайте нескольких провайдеров в разных юрисдикциях:**
   - Для резервирования используйте серверы в разных странах
   - Это обеспечит отказоустойчивость и защиту от блокировок

5. **Учитывайте стоимость и надежность:**
   - Балансируйте между ценой, качеством обслуживания и географическим расположением
   - Ищите провайдеров с гарантией uptime не менее 99.9%

---

## Базовая настройка и обеспечение безопасности сервера

После получения доступа к VPS-серверу необходимо выполнить ряд действий для повышения безопасности системы. 

> **Важно:** Без этих мер ваш сервер будет уязвим для автоматических атак, которые постоянно сканируют интернет в поисках незащищенных серверов.

### 1. Смена пароля суперпользователя (root)

По умолчанию многие провайдеры устанавливают простой или автоматически сгенерированный пароль для пользователя root. Это делает сервер легкой мишенью для атак.

```bash
passwd
```

**Требования к надежному паролю:**

- Длина от 15-20 символов
- Сочетание заглавных и строчных букв
- Наличие цифр и специальных символов
- Отсутствие связи с вашей личной информацией
- Уникальность (не используется нигде еще)

> **Пример хорошего пароля:** `Minecraft_eto_moja_jizn'2024!!!2402`

### 2. Обновление системы

Регулярное обновление пакетов системы критически важно для безопасности, так как в новых версиях исправляются известные уязвимости.

```bash
apt update && apt upgrade -y && reboot
```

### 3. Защита SSH соединения

SSH (Secure Shell) — основной способ удаленного доступа к серверу. В будущем мы будем использовать только данный тип подключения к терминалу VPS. Для защиты необходимо выполнить несколько шагов:

#### 3.1. Создание нового пользователя

Во-первых, необходимо создать обычного пользователя с ограниченными правами, а не использовать root для повседневной работы. (user_name меняете на предпочтительный)

```bash
adduser user_name
```

Следуйте инструкциям на экране, обязательно установив пароль для пользователя. Остальные поля можно оставить пустыми.

**Полезные команды:**

- От обычного пользователя к root: `su -`
- От root к обычному пользователю: `su user_name`

#### 3.2. Настройка SSH конфигурации

Редактируем конфигурационный файл SSH:

```bash
nano /etc/ssh/sshd_config
```

Вносим следующие изменения:

**Изменяем стандартный порт SSH (по умолчанию 22):**

```
Port 2222
```

**Запрещаем вход под пользователем root:**

```
PermitRootLogin no
```

Сохраняем файл (`Ctrl+O`, затем `Enter`) и закрываем редактор (`Ctrl+X`).

После внесения изменений перезапускаем SSH-сервис:

```bash
systemctl restart sshd
```

Теперь подключаться к серверу нужно будет командой:

```bash
ssh -p 2222 user_name@server_ip
```

#### 3.3. Настройка аутентификации по SSH-ключам

Аутентификация по ключам значительно безопаснее парольной аутентификации, так как современные алгоритмы шифрования практически невозможно взломать подбором.

**На клиентском компьютере (Windows):**

Генерируем пару ключей (приватный и публичный):

```bash
ssh-keygen -t ed25519 -C "your_email@example.com"
```

Система спросит:

- Куда сохранить ключи (рекомендуется оставить стандартный путь)
- Нужно ли защитить ключ паролем (если установить пароль, его придется вводить при каждом подключении)

Копируем публичный ключ на сервер:

```bash
cat ~/.ssh/id_ed25519.pub | ssh user_name@server_ip  -p port_number "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

**Для Linux (или WSL):**

```bash
ssh-copy-id -p 2222 user_name@server_ip
```

Проверяем подключение:

```bash
ssh -p 2222 user_name@server_ip
```

Если подключение успешно, настраиваем конфигурационный файл для удобства подключения. Создаем файл конфигурации (на локальной машине):

```bash
mkdir -p ~/.ssh
```

Открываем его в редакторе:

```bash
nano ~/.ssh/config
```

Добавляем следующие настройки:

```
Host myserver
    HostName server_ip
    User user_name
    Port 2222
    IdentityFile ~/.ssh/id_ed25519
    ServerAliveInterval 60
    ServerAliveCountMax 3
    Compression yes
    ControlMaster auto
    ControlPath ~/.ssh/master-%r@%h:%p
```

Теперь можно подключаться простой командой:

```bash
ssh myserver
```

#### 3.4. Отключение аутентификации по паролю

После успешной настройки ключей рекомендуется полностью отключить аутентификацию по паролю:

```bash
sudo nano /etc/ssh/sshd_config
```

Находим и изменяем следующие параметры:

```
PasswordAuthentication no
ChallengeResponseAuthentication no
```

Сохраняем файл и перезапускаем SSH:

```bash
sudo systemctl restart sshd
```

### 4. Установка и настройка Fail2ban

Fail2ban — программа для защиты сервера от атак методом перебора паролей (brute-force). Она анализирует логи сервера и автоматически блокирует IP-адреса, с которых производится множество неудачных попыток входа.

**Установка Fail2ban:**

```bash
sudo apt install fail2ban -y
```

**Проверка статуса:**

```bash
sudo systemctl status fail2ban
```

**По умолчанию Fail2ban:**

- Блокирует IP-адрес на 10 минут после 5 неудачных попыток входа
- Использует стандартные настройки для SSH-защиты

**Настройка Fail2ban:**

Редактируем основной конфигурационный файл:

```bash
sudo nano /etc/fail2ban/jail.local
```

**Важные параметры для настройки:**

- `bantime` — время блокировки в секундах (по умолчанию 600 = 10 минут)
- `findtime` — временной интервал для подсчета неудачных попыток
- `maxretry` — количество неудачных попыток перед блокировкой
- `port` — порт для защиты (должен соответствовать вашему SSH-порту)

Пример настройки для SSH:

```ini
[sshd]
enabled = true
port = 2222
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600
findtime = 600
```

После внесения изменений перезапускаем службу:

```bash
sudo systemctl restart fail2ban
```

**Полезные команды для управления Fail2ban:**

- Просмотр заблокированных IP: `fail2ban-client status sshd`
- Разблокировка IP: `fail2ban-client set sshd unbanip IP_ADDRESS`
- Проверка логов: `tail -f /var/log/fail2ban.log`

### 5. Установка необходимых пакетов

Для удобства администрирования сервера рекомендуется установить следующие пакеты:

```bash
sudo apt install git nmap net-tools curl -y
```

**Описание пакетов:**

- `git` — система контроля версий для скачивания программного обеспечения
- `nmap` — утилита для сканирования сетей и проверки открытых портов
- `net-tools` — набор сетевых утилит (включает ifconfig, netstat)
- `curl` — утилита для выполнения HTTP-запросов из командной строки

---

## Проверка безопасности сервера

После выполнения всех настроек рекомендуется провести проверку безопасности:

**1. Проверка открытых портов:**

```bash
sudo nmap -sT -O localhost
```

На сервере должны быть открыты только необходимые порты (SSH на вашем нестандартном порту).

**2. Проверка настроек SSH:**

```bash
sshd -T | grep -E 'passwordauthentication|permitrootlogin|port'
```

В выводе убедитесь, что используется аутентификация по ключам, а не по паролю.

---

## Заключение
### Основные принципы безопасности

- Никогда не используйте учетные данные по умолчанию
- Регулярно обновляйте систему и программное обеспечение
- Минимизируйте количество открытых портов
- Используйте аутентификацию по ключам вместо паролей
- Внедряйте системы обнаружения вторжений (Fail2ban)
- Следите за логами системы на предмет подозрительной активности

> **Помните:** Безопасность — это непрерывный процесс, а не разовое действие. Регулярно проверяйте настройки безопасности и обновляйте их.